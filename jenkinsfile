pipeline {
    agent any
    stages {
        stage("Test") {
			steps {
				
				slackSend channel: 'junittesting', message: 'Starting'
				sh 'mvn surefire:test surefire-report:report'
				
				//sh  'cd /var/lib/jenkins/workspace/junitreportgeneration/target/surefire-reports'
				//sh 'touch *.xml'
			}
		}
        stage("build") {
            steps {
				slackSend channel: 'junittesting', message: 'Building'
                 sh  'mvn -Dmaven.test.skip=true surefire-report:report'
            }
        }
    }
    post {
        always {
            archiveArtifacts "target/**/*"
            junit '**/surefire-reports/*.xml' 
			slackUploadFile filePath: 'target/site/surefire-report.html', initialComment: 'report'
         }  
		 publishHTML (target:  [
			 allowMissing: false,
			 alwaysLinkToLastBuild: false,
			 keepAll: false,
			 reportDir: 'site',
			 reportFiles: 'surefire-report.html',
			 reportName: 'HTML Report',
			 reportTitles: 'HML Report'
			 ] )
        }	
}