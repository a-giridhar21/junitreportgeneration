pipeline {
    agent any
    stages {
        stage("Test") {
			steps {
				
				slackSend channel: 'junittesting', message: 'Starting'
				sh 'mvn surefire:test surefire-report:report'
				
				//sh  'cd /var/lib/jenkins/workspace/junitreportgeneration/target/surefire-reports'
				//sh 'touch *.xml'
			}
		}
        stage("build") {
            steps {
				slackSend channel: 'junittesting', message: 'Building'
                 sh  'mvn -Dmaven.test.skip=true surefire-report:report'
				 sh  'cp /var/lib/jenkins/workspace/junitreportgeneration/target/site/surefire-report.html /var/lib/jenkins/workspace/junitreportgeneration/surefire-report.html'
				 sh  'sudo chmod 777 /var/lib/jenkins/workspace/junitreportgeneration/surefire-report.html'
				 sh 'ls -l /var/lib/jenkins/workspace/junitreportgeneration/surefire-report.html'
            }
		}
		stage("Slack notification") {
			steps {
				slackSend baseUrl: 'https://hooks.slack.com/services/', channel: '#junittesting', color: 'good', message: 'Jenkins Build Completed', teamDomain: 'a1devopsconsulting', tokenCredentialId: 'slackunit', username: 'Chandrakanth'
				slackUploadFile channel: '#junittesting', credentialId: 'slackunit', filePath: 'surefire-report.html', initialComment: 'Test Reports'
			}
		
		}

    }
    post {
        always {
            archiveArtifacts "target/**/*"
            junit '**/surefire-reports/*.xml' 
         }  
        }
    }			